<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title>Unsafe Triangulator | BurstTriangulator </title>
      <meta name="viewport" content="width=device-width">
      <meta name="title" content="Unsafe Triangulator | BurstTriangulator ">
    
    
      <link rel="shortcut icon" href="../../images/favicon.ico">
      <link rel="stylesheet" href="../../styles/docfx.vendor.min.css">
      <link rel="stylesheet" href="../../styles/docfx.css">
      <link rel="stylesheet" href="../../styles/main.css">
      <meta property="docfx:navrel" content="../../toc.html">
      <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../images/logo.svg" alt="BurstTriangulator">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search" style="
                display: flex;
                flex-direction: row-reverse;
                justify-content: space-between;
                align-items: center;">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
                <!-- Added by me -->
                <div style="margin-right: 15px;"><a href="https://github.com/andywiecko/BurstTriangulator/"><i class="fa fa-github" style="font-size:30px; color: white"></i></a></div>
              </form>
            </div>
          </div>
        </nav>        <div class="subnav navbar navbar-default">
            <div class="container" style="
                display: flex;
                flex-direction: row-reverse;
                justify-content: space-between;
                align-items: center;
            ">
                <div class="container hide-when-search" id="breadcrumb">
                 <ul class="breadcrumb">
                   <li></li>
                 </ul>
                </div>
                <div class="container" style="
                    width: 80px;
                    line-height: 40px;
                "><b>v3.3.0</b></div>
          </div>
        </div>      </header>
      <div class="container body-content">

        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">

        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="unsafe-triangulator">Unsafe Triangulator</h1>

<div class="CAUTION">
<h5>Caution</h5>
<p>Use the unsafe context with caution! Ensure that you fully understand what you are doing. It is recommended to first familiarize yourself with the managed <a class="xref" href="../../api/andywiecko.BurstTriangulator.Triangulator-1.html"><code>Triangulator</code></a>. Using the unsafe triangulator can lead to unexpected behavior if not used correctly.
<em>Unsafe</em> in this context indicates that this API may be challenging for beginner users.
The user is responsible for managing data allocation (both input and output).
Note that some permutations of method calls may not be supported.
The term <em>unsafe</em> does <strong>not</strong> refer to memory safety.</p>
</div>
<p>The package also provides a low-level API through <a class="xref" href="../../api/andywiecko.BurstTriangulator.LowLevel.Unsafe.UnsafeTriangulator-1.html"><code>UnsafeTriangulator&lt;T2&gt;</code></a>.
This can be used for customization of the triangulation and for use in a native context.
To use this, similar to <code>Unity.Collections</code>, you need to load the low-level namespace:</p>
<pre><code class="lang-csharp">using andywiecko.BurstTriangulator.LowLevel.Unsafe;
</code></pre>
<p><a class="xref" href="../../api/andywiecko.BurstTriangulator.LowLevel.Unsafe.UnsafeTriangulator-1.html"><code>UnsafeTriangulator&lt;T2&gt;</code></a> is an empty readonly struct which provide API which can be used directly in native context in the jobs pipeline.
Additionally this struct allows much more customization with respect to managed <a class="xref" href="../../api/andywiecko.BurstTriangulator.Triangulator-1.html"><code>Triangulator&lt;T2&gt;</code></a>,
however, the user is responsible to data allocation, including output data.
Below one can find minimal working example using <a class="xref" href="../../api/andywiecko.BurstTriangulator.LowLevel.Unsafe.UnsafeTriangulator-1.html"><code>UnsafeTriangulator&lt;T2&gt;</code></a></p>
<pre><code class="lang-csharp">using var positions = new NativeArray&lt;float2&gt;(..., Allocator.Temp);
using var triangles = new NativeArray&lt;int&gt;(64, Allocator.Temp);
new UnsafeTriangulator&lt;float2&gt;().Triangulate(
    input: new() { Positions = positions },
    output: new() { Triangles = triangles },
    args: Args.Default(),
    allocator: Allocator.Persistent
);
</code></pre>
<p>this corresponds to the following managed approach with <a class="xref" href="../../api/andywiecko.BurstTriangulator.Triangulator-1.html"><code>Triangulator&lt;T2&gt;</code></a></p>
<pre><code class="lang-csharp">using var triangulator = new Triangulator(Allocator.Persistent)
{
    Input = { Positions = new float2[]{ ... }.AsNativeArray() }
};
triangulator.Run();
var triangles = triangulator.Output.Triangles;
</code></pre>
<p>Learn more in the <a href="#parameters">Parameters</a> section about how to set up the triangulation and the <a href="#extensions">Extensions</a> section to learn about other customization steps for triangulation.</p>
<h2 id="parameters">Parameters</h2>
<p>All extension methods related to <a class="xref" href="../../api/andywiecko.BurstTriangulator.LowLevel.Unsafe.UnsafeTriangulator-1.html"><code>UnsafeTriangulator&lt;T2&gt;</code></a> API except standard additional parameters,
include custom struct parameters:</p>
<ul>
<li><a class="xref" href="../../api/andywiecko.BurstTriangulator.LowLevel.Unsafe.InputData-1.html"><code>LowLevel.Unsafe.InputData&lt;T2&gt;</code></a>,</li>
<li><a class="xref" href="../../api/andywiecko.BurstTriangulator.LowLevel.Unsafe.OutputData-1.html"><code>LowLevel.Unsafe.OutputData&lt;T2&gt;</code></a>,</li>
<li><a class="xref" href="../../api/andywiecko.BurstTriangulator.LowLevel.Unsafe.Args.html"><code>LowLevel.Unsafe.Args</code></a>.</li>
</ul>
<p>The first two structs are the same as managed types <a class="xref" href="../../api/andywiecko.BurstTriangulator.InputData-1.html"><code>InputData&lt;T2&gt;</code></a> and <a class="xref" href="../../api/andywiecko.BurstTriangulator.OutputData-1.html"><code>OutputData&lt;T2&gt;</code></a>, respectively. They have the same fields/properties.
Similar situation is with <a class="xref" href="../../api/andywiecko.BurstTriangulator.LowLevel.Unsafe.Args.html"><code>LowLevel.Unsafe.Args</code></a> and managed corresponding <a class="xref" href="../../api/andywiecko.BurstTriangulator.TriangulationSettings.html"><code>TriangulationSettings</code></a>, however the first, one is readonly struct and cannot be easily modified.</p>
<p>Due to current C# lang version restriction used in Unity structs cannot have default values for field and properties. To create <a class="xref" href="../../api/andywiecko.BurstTriangulator.LowLevel.Unsafe.Args.html"><code>Args</code></a> manually use <a class="xref" href="../../api/andywiecko.BurstTriangulator.LowLevel.Unsafe.Args.Default.html"><code>Args.Default()</code></a> method and pass parameter which you want to change from default value, e.g.</p>
<pre><code class="lang-csharp">var args = Args.Default(refineMesh: true);
</code></pre>
<p>To &quot;modify&quot; the <a class="xref" href="../../api/andywiecko.BurstTriangulator.LowLevel.Unsafe.Args.html">LowLevel.Unsafe.Args</a>, one can use the <a class="xref" href="../../api/andywiecko.BurstTriangulator.LowLevel.Unsafe.Args.With.html">With</a> method. This method returns new args with the selected parameters replaced. For example:</p>
<pre><code class="lang-csharp">var args = Args.Default();
args = args.With(refineMesh: true);
</code></pre>
<p><a class="xref" href="../../api/andywiecko.BurstTriangulator.LowLevel.Unsafe.Args.html"><code>LowLevel.Unsafe.Args</code></a> can be implicitly converted from <a class="xref" href="../../api/andywiecko.BurstTriangulator.TriangulationSettings.html"><code>TriangulationSettings</code></a>. So one can store <a class="xref" href="../../api/andywiecko.BurstTriangulator.TriangulationSettings.html"><code>TriangulationSettings</code></a> as a serialized field in a <a class="xref" href="https://docs.unity3d.com/ScriptReference/MonoBehaviour.html"><code>MonoBehaviour</code></a> and cast to args if necessary</p>
<pre><code class="lang-csharp">var settings = new TriangulationSettings();
Args args = settings;
</code></pre>
<h2 id="extensions">Extensions</h2>
<p>Below, you can find extensions (with descriptions and examples) that can be used with <a class="xref" href="../../api/andywiecko.BurstTriangulator.LowLevel.Unsafe.UnsafeTriangulator-1.html"><code>UnsafeTriangulator</code></a>. Check out the unit tests for additional use cases.</p>
<h3 id="triangulate"><code>Triangulate</code></h3>
<p>The extension <a class="xref" href="../../api/andywiecko.BurstTriangulator.LowLevel.Unsafe.Extensions.Triangulate.html"><code>Triangulate(input, output, args, allocator)</code></a> is the simplest option to use. The action of this extension essentially produces the same result as the <a class="xref" href="../../api/andywiecko.BurstTriangulator.Extensions.Run.html"><code>Run</code></a> method for the managed <a class="xref" href="../../api/andywiecko.BurstTriangulator.Triangulator-1.html"><code>Triangulator</code></a>. It can be useful when triangulation is done with <a href="https://docs.unity3d.com/Packages/com.unity.collections@2.2/manual/allocator-overview.html#allocatortemp"><code>Allocator.Temp</code></a> in a single job or to combine this with different extensions.</p>
<pre><code class="lang-csharp">using var positions = new NativeArray&lt;float2&gt;(..., Allocator.Persistent);
using var constraints = new NativeArray&lt;int&gt;(..., Allocator.Persistent);
using var holesSeeds = new NativeArray&lt;float2&gt;(..., Allocator.Persistent);
using var triangles = new NativeList&lt;int&gt;(64, Allocator.Persistent);
new UnsafeTriangulator&lt;float2&gt;().Triangulate(
    input: new() { Positions = positions, ConstraintEdges = constraints, HoleSeeds = holesSeeds },
    output: new() { Triangles = triangles },
    args: Args.Default(refineMesh: true, restoreBoundary: true),
    allocator: Allocator.Persistent
);
</code></pre>
<h3 id="plantholeseeds"><code>PlantHoleSeeds</code></h3>
<p>The extension <a class="xref" href="../../api/andywiecko.BurstTriangulator.LowLevel.Unsafe.Extensions.PlantHoleSeeds.html"><code>PlantHoleSeeds(input, output, args, allocator)</code></a> is particularly useful when the user requires mesh data <em>without</em> removed triangles and additional mesh copy <em>with</em> removed triangles. In this case, the triangulation is performed once, which is generally a more expensive operation. Below is an example usage with the <code>autoHolesAndBoundary</code> option selected:</p>
<pre><code class="lang-csharp">var input = new LowLevel.Unsafe.InputData&lt;double2&gt;
{
    Positions = ...,
    ConstraintEdges = ...,
};
using var triangles = new NativeList&lt;int&gt;(Allocator.Persistent);
using var halfedges = new NativeList&lt;int&gt;(Allocator.Persistent);
using var constrainedHalfedges = new NativeList&lt;bool&gt;(Allocator.Persistent);
var output = new LowLevel.Unsafe.OutputData&lt;double2&gt;
{
    Triangles = triangles,
    Halfedges = halfedges,
    ConstrainedHalfedges = constrainedHalfedges,
};
var args = Args.Default();
var t = new UnsafeTriangulator&lt;double2&gt;();
t.Triangulate(input, output, args), Allocator.Persistent);
t.PlantHoleSeeds(input, output, args.With(autoHolesAndBoundary: true), Allocator.Persistent);
</code></pre>
<div class="NOTE">
<h5>Note</h5>
<p>Depending on the options, some of the buffers may not be required for <a class="xref" href="../../api/andywiecko.BurstTriangulator.LowLevel.Unsafe.Extensions.PlantHoleSeeds.html"><code>PlantHoleSeeds</code></a>. For example, when the user provides <code>HoleSeeds</code> in <a class="xref" href="../../api/andywiecko.BurstTriangulator.LowLevel.Unsafe.OutputData-1.html"><code>InputData&lt;T2&gt;</code></a>, <code>Positions</code> in <a class="xref" href="../../api/andywiecko.BurstTriangulator.LowLevel.Unsafe.OutputData-1.html"><code>OutputData&lt;T2&gt;</code></a> must be provided. However, in other cases, it may not be required.</p>
</div>
<h3 id="refinemesh"><code>RefineMesh</code></h3>
<p>The extension <a class="xref" href="../../api/andywiecko.BurstTriangulator.LowLevel.Unsafe.Extensions.RefineMesh.html"><code>RefineMesh(output, allocator, areaThreshold?, angleThreshold?, concentricShells?, constrainBoundary?)</code></a> can be used to refine any triangulation mesh, even an already refined one. Please note that both the managed <a class="xref" href="../../api/andywiecko.BurstTriangulator.TriangulationSettings.html"><code>TriangulationSettings</code></a> and native <a class="xref" href="../../api/andywiecko.BurstTriangulator.LowLevel.Unsafe.Args.html"><code>Args</code></a> provide refinement parameter setups only for <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.single"><code>float</code></a> precision. This extension allows you to provide these parameters with the selected precision type <code>T</code> in generics. These parameters have the following default values (in the given precision type <code>T</code>, if this extension is available for <code>T</code>):</p>
<ul>
<li><code>areaThreshold = 1</code>;</li>
<li><code>angleThreshold = math.radians(5)</code></li>
<li><code>concentricShells = 0.001</code></li>
</ul>
<p>The last optional parameter, <code>constrainBoundary</code>, is used to constrain boundary halfedges. Since the refinement algorithm (whether for constrained triangulation or not) requires constrained halfedges at the boundary, not setting this option may cause unexpected behavior, especially when the <code>restoreBoundary</code> option is disabled.</p>
<p>Below is an example of refinement in the unsafe context:</p>
<pre><code class="lang-csharp">using var triangles = new NativeList&lt;int&gt;(Allocator.Persistent);
using var halfedges = new NativeList&lt;int&gt;(Allocator.Persistent);
using var constrainedHalfedges = new NativeList&lt;bool&gt;(Allocator.Persistent);
using var outputPositions = new NativeList&lt;float2&gt;(Allocator.Persistent);
var input = new LowLevel.Unsafe.InputData&lt;float2&gt;
{
    Positions = ...,
    ConstraintEdges = ...,
};
var output = new LowLevel.Unsafe.OutputData&lt;float2&gt;
{
    Triangles = triangles,
    Halfedges = halfedges,
    Positions = outputPositions,
    ConstrainedHalfedges = constrainedHalfedges
};
var t = new UnsafeTriangulator&lt;float2&gt;();
t.Triangulate(input, output, Args.Default(restoreBoundary: true), Allocator.Persistent);
t.RefineMesh(output, Allocator.Persistent, areaThreshold: 1, angleThreshold: 0.5f, constrainBoundary: false);
</code></pre>

</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In this article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      Generated by <strong>DocFX</strong> | Documentation © 2024 by <a href="https://github.com/andywiecko">Andrzej Więckowski</a> is licensed under CC BY 4.0
      
          </div>
        </div>
      </footer>
    </div>
    <!-- https://github.com/dotnet/docfx/tree/main/templates/default/partials -->
    <!-- https://github.com/dotnet/docfx/tree/main/templates/statictoc/partials -->
    <script type="text/javascript" src="../../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <style>
    .hljs {
        background: #f5f5f5;
    }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  </body>
</html>
